---
sidebar_class_name: hidden
---

import React, { useState, useEffect } from 'react';
import Item, { calculateItemStats } from '@site/src/components/Item';
import basesData from '@site/static/data/items/bases.json';
import prefixesData from '@site/static/data/items/prefixes.json';
import suffixesData from '@site/static/data/items/suffixes.json';
import ExecutionEnvironment from '@docusaurus/ExecutionEnvironment';

# Item Planner

`Beta`

Plan your perfect item by selecting a base item, prefix, and suffix to see all rarity variations.

export const SearchableSelect = ({ options, value, onChange, placeholder, label }) => {
  const [search, setSearch] = useState('');
  const [isOpen, setIsOpen] = useState(false);
  
  const filteredOptions = options.filter(opt => 
    opt.label.toLowerCase().includes(search.toLowerCase())
  );
  
  const selectedOption = options.find(opt => opt.value === value);
  
  return (
    <div style={{ position: 'relative' }}>
      <label>{label}</label>
      <div>
        <input
          type="text"
          value={search}
          onChange={(e) => setSearch(e.target.value)}
          onFocus={() => setIsOpen(true)}
          placeholder={selectedOption ? selectedOption.label : placeholder}
          style={{ 
            padding: '5px', 
            minWidth: '200px',
            width: '100%'
          }}
        />
        {value && (
          <button
            onClick={() => {
              onChange('');
              setSearch('');
            }}
            style={{
              position: 'absolute',
              right: '5px',
              top: '28px',
              border: 'none',
              background: 'transparent',
              cursor: 'pointer',
              fontSize: '16px'
            }}
          >
            Ã—
          </button>
        )}
      </div>
      {isOpen && (
        <>
          <div
            style={{
              position: 'fixed',
              top: 0,
              left: 0,
              right: 0,
              bottom: 0,
              zIndex: 1
            }}
            onClick={() => setIsOpen(false)}
          />
          <div
            style={{
              position: 'absolute',
              top: '100%',
              left: 0,
              right: 0,
              maxHeight: '300px',
              overflowY: 'auto',
              backgroundColor: '#ffffff',
              border: '1px solid var(--ifm-color-emphasis-300)',
              borderRadius: '4px',
              zIndex: 2,
              boxShadow: '0 2px 8px rgba(0,0,0,0.15)'
            }}
          >
            {filteredOptions.map(opt => (
              <div
                key={opt.value + opt.label}
                onClick={() => {
                  if (!opt.isHeader) {
                    onChange(opt.value);
                    setSearch('');
                    setIsOpen(false);
                  }
                }}
                style={{
                  padding: '8px 12px',
                  cursor: opt.isHeader ? 'default' : 'pointer',
                  backgroundColor: 'transparent',
                  fontWeight: opt.isHeader ? 'bold' : 'normal',
                  fontSize: opt.isHeader ? '14px' : '13px',
                  color: opt.isHeader ? 'var(--ifm-color-primary)' : 'inherit',
                  borderBottom: opt.isHeader ? '1px solid var(--ifm-color-emphasis-300)' : 'none',
                  marginTop: opt.isHeader ? '4px' : '0'
                }}
                onMouseEnter={(e) => {
                  if (!opt.isHeader) {
                    e.target.style.backgroundColor = 'var(--ifm-color-emphasis-200)';
                  }
                }}
                onMouseLeave={(e) => e.target.style.backgroundColor = 'transparent'}
              >
                {opt.label}
              </div>
            ))}
            {filteredOptions.length === 0 && (
              <div style={{ padding: '8px 12px', color: 'var(--ifm-color-emphasis-600)' }}>
                No results found
              </div>
            )}
          </div>
        </>
      )}
    </div>
  );
};

export const ItemPlanner = () => {
  const [selectedBase, setSelectedBase] = useState('');
  const [selectedPrefix, setSelectedPrefix] = useState('');
  const [selectedSuffix, setSelectedSuffix] = useState('');
  const [copySuccess, setCopySuccess] = useState(false);
  
  // Load base, prefix, and suffix from URL params on mount
  useEffect(() => {
    if (!ExecutionEnvironment.canUseDOM) return;
    
    const params = new URLSearchParams(window.location.search);
    const baseParam = params.get('base');
    const prefixParam = params.get('prefix');
    const suffixParam = params.get('suffix');
    
    if (baseParam) {
      const baseExists = basesData.some(item => item.name === baseParam);
      if (baseExists) {
        setSelectedBase(baseParam);
      }
    }
    
    if (prefixParam) {
      const prefixExists = prefixesData.some(p => p.name === prefixParam);
      if (prefixExists) {
        setSelectedPrefix(prefixParam);
      }
    }
    
    if (suffixParam) {
      const suffixExists = suffixesData.some(s => s.name === suffixParam);
      if (suffixExists) {
        setSelectedSuffix(suffixParam);
      }
    }
  }, []);
  
  // Update URL params when selections change
  useEffect(() => {
    if (!ExecutionEnvironment.canUseDOM) return;
    
    const params = new URLSearchParams(window.location.search);
    
    if (selectedBase) {
      params.set('base', selectedBase);
    } else {
      params.delete('base');
    }
    
    if (selectedPrefix) {
      params.set('prefix', selectedPrefix);
    } else {
      params.delete('prefix');
    }
    
    if (selectedSuffix) {
      params.set('suffix', selectedSuffix);
    } else {
      params.delete('suffix');
    }
    
    const newUrl = params.toString() 
      ? `${window.location.pathname}?${params.toString()}`
      : window.location.pathname;
    
    window.history.replaceState({}, '', newUrl);
  }, [selectedBase, selectedPrefix, selectedSuffix]);
  
  // Copy current URL to clipboard
  const copyLinkToClipboard = () => {
    if (!ExecutionEnvironment.canUseDOM) return;
    
    navigator.clipboard.writeText(window.location.href).then(() => {
      setCopySuccess(true);
      setTimeout(() => setCopySuccess(false), 2000);
    }).catch(err => {
      console.error('Failed to copy link:', err);
    });
  };
  
  const baseItem = basesData.find(item => item.name === selectedBase);
  const prefix = prefixesData.find(p => p.name === selectedPrefix);
  const suffix = suffixesData.find(s => s.name === selectedSuffix);
  
  const prefixOptions = [
    { value: '', label: 'None' },
    ...prefixesData.map(p => ({ value: p.name, label: `${p.name} (${p.level})` }))
  ];
  
  // Group base items by type
  const groupedBases = basesData.reduce((acc, item) => {
    if (!acc[item.type]) {
      acc[item.type] = [];
    }
    acc[item.type].push(item);
    return acc;
  }, {});
  
  const baseOptions = Object.entries(groupedBases).flatMap(([type, items]) => [
    { value: '', label: type.charAt(0).toUpperCase() + type.slice(1), isHeader: true },
    ...items.map(item => ({ 
      value: item.name, 
      label: `${item.name} (${item.level})` 
    }))
  ]);
  
  const suffixOptions = [
    { value: '', label: 'None' },
    ...suffixesData.map(s => ({ value: s.name, label: `${s.name} (${s.level})` }))
  ];
  
  const rarities = [
    { rarity: 'green', conditioned: false, label: 'Green', color: '#00ff00' },
    { rarity: 'green', conditioned: true, label: 'Green+', color: '#00ff00' },
    { rarity: 'blue', conditioned: false, label: 'Blue', color: '#0080ff' },
    { rarity: 'blue', conditioned: true, label: 'Blue+', color: '#0080ff' },
    { rarity: 'purple', conditioned: false, label: 'Purple', color: '#a335ee' },
    { rarity: 'purple', conditioned: true, label: 'Purple+', color: '#a335ee' },
    { rarity: 'orange', conditioned: false, label: 'Orange', color: '#ff8000' },
    { rarity: 'orange', conditioned: true, label: 'Orange+', color: '#ff8000' },
    { rarity: 'red', conditioned: false, label: 'Red', color: '#ff0000' },
    { rarity: 'red', conditioned: true, label: 'Red+', color: '#ff0000' },
  ];
  
  return (
    <div>
      <div style={{ marginBottom: '20px' }}>
        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '10px' }}>
          <h3 style={{ margin: 0 }}>Item Configuration</h3>
          {(selectedBase || selectedPrefix || selectedSuffix) && (
            <button
              onClick={copyLinkToClipboard}
              style={{
                padding: '8px 16px',
                backgroundColor: copySuccess ? '#28a745' : 'var(--ifm-color-primary)',
                color: 'white',
                border: 'none',
                borderRadius: '4px',
                cursor: 'pointer',
                fontSize: '14px',
                fontWeight: 'bold',
                transition: 'background-color 0.2s'
              }}
            >
              {copySuccess ? 'âœ“ Copied!' : 'ðŸ”— Copy Link'}
            </button>
          )}
        </div>
        <div style={{ display: 'flex', gap: '10px', flexWrap: 'wrap' }}>
          <SearchableSelect
            options={prefixOptions}
            value={selectedPrefix}
            onChange={setSelectedPrefix}
            placeholder="Search prefix..."
            label="Prefix:"
          />
          
          <SearchableSelect
            options={baseOptions}
            value={selectedBase}
            onChange={setSelectedBase}
            placeholder="Search base item..."
            label="Base Item:"
          />
          
          <SearchableSelect
            options={suffixOptions}
            value={selectedSuffix}
            onChange={setSelectedSuffix}
            placeholder="Search suffix..."
            label="Suffix:"
          />
        </div>
      </div>
      
      {(prefix || suffix) && (
        <div style={{ marginBottom: '30px' }}>
          <div style={{ display: 'flex', gap: '20px', flexWrap: 'wrap' }}>
            {prefix && (
              <div>
                <strong>Prefix: {prefix.name} (Level {prefix.level})</strong>
                <div style={{ marginTop: '5px', fontSize: '14px' }}>
                  {Object.entries(prefix.stats).map(([stat, value]) => (
                    <div key={stat}>
                      {stat.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase())}
                      {value.flat !== 0 && ` ${value.flat > 0 ? '+' : ''}${value.flat}`}
                      {value.percent !== 0 && ` ${value.percent > 0 ? '+' : ''}${value.percent}%`}
                    </div>
                  ))}
                </div>
              </div>
            )}
            {suffix && (
              <div>
                <strong>Suffix: {suffix.name} (Level {suffix.level})</strong>
                <div style={{ marginTop: '5px', fontSize: '14px' }}>
                  {Object.entries(suffix.stats).map(([stat, value]) => (
                    <div key={stat}>
                      {stat.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase())}
                      {value.flat !== 0 && ` ${value.flat > 0 ? '+' : ''}${value.flat}`}
                      {value.percent !== 0 && ` ${value.percent > 0 ? '+' : ''}${value.percent}%`}
                    </div>
                  ))}
                </div>
              </div>
            )}
          </div>
        </div>
      )}
      
      {baseItem && (
        <div>
          <h3>Item Preview</h3>
          <div style={{ display: 'flex', gap: '30px', flexWrap: 'wrap', alignItems: 'flex-start' }}>
            {rarities.map(({ rarity, conditioned, label, color }) => {
              const stats = calculateItemStats(baseItem, rarity, conditioned, prefix, suffix);
              return (
                <div key={label} style={{ 
                  marginBottom: '40px',
                  padding: '10px',
                  border: '1px solid var(--ifm-color-emphasis-200)',
                  borderRadius: '4px',
                  minWidth: '200px'
                }}>
                  <strong style={{ color, fontSize: '16px' }}>{label}</strong><br />
                  <br />
                  <Item 
                    baseItem={baseItem}
                    prefix={prefix}
                    suffix={suffix}
                    rarity={rarity}
                    conditioned={conditioned}
                  />
                </div>
              );
            })}
          </div>
        </div>
      )}
      
      {!baseItem && (
        <p style={{ color: '#666', fontStyle: 'italic' }}>
          Select a base item to start planning
        </p>
      )}
    </div>
  );
};

<ItemPlanner />
